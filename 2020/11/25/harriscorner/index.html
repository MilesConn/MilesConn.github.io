<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Harris Corner Detectors are Awesome! | The Ephemeral Homestead</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css">
    <meta name="description" content="

Today I want to talk about one of my favorite things I've learned from taking
Computer Vision this semester. I
would say Harris Corner Detectors are my f ...">
    
    <link rel="preload" href="/assets/css/0.styles.bc01238d.css" as="style"><link rel="preload" href="/assets/js/app.6755fb66.js" as="script"><link rel="preload" href="/assets/js/7.f907bda9.js" as="script"><link rel="preload" href="/assets/js/3.eef58f39.js" as="script"><link rel="preload" href="/assets/js/6.f4eca287.js" as="script"><link rel="prefetch" href="/assets/js/10.39121d6f.js"><link rel="prefetch" href="/assets/js/11.e4da73fe.js"><link rel="prefetch" href="/assets/js/12.03d2d64f.js"><link rel="prefetch" href="/assets/js/13.9faf7b47.js"><link rel="prefetch" href="/assets/js/14.32ff7a33.js"><link rel="prefetch" href="/assets/js/15.c6231382.js"><link rel="prefetch" href="/assets/js/16.a8860f1b.js"><link rel="prefetch" href="/assets/js/17.1eb3b247.js"><link rel="prefetch" href="/assets/js/18.a092845f.js"><link rel="prefetch" href="/assets/js/19.2db15d0d.js"><link rel="prefetch" href="/assets/js/4.7cb1d78a.js"><link rel="prefetch" href="/assets/js/5.a4f554e9.js"><link rel="prefetch" href="/assets/js/8.a47733f8.js"><link rel="prefetch" href="/assets/js/9.d12c4f67.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.71f95fcd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bc01238d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">The Ephemeral Homestead </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/posts/" class="nav-link">Posts</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">The Ephemeral Homestead </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/posts/" class="nav-link">Posts</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        Harris Corner Detectors are Awesome!
      </h1> <div class="post-meta"><!----> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2020-11-25T00:00:00.000Z">
      Wed Nov 25 2020
    </time></div> <!----></div></header> <div itemprop="articleBody" class="content__default"><h1 id="this-page-is-not-done-but-yeah-soon"><a href="#this-page-is-not-done-but-yeah-soon" class="header-anchor">#</a> THIS PAGE IS NOT DONE BUT YEAH, soon ...</h1> <p>Today I want to talk about one of my favorite things I've learned from taking
<a href="http://16385.courses.cs.cmu.edu/fall2020/" target="_blank" rel="noopener noreferrer">Computer Vision<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> this semester. I
would say Harris Corner Detectors are my favorite topic because there's a
<em>healthy</em> amount of math but it all comes together for a super elegant solution.</p> <h2 id="disclaimer"><a href="#disclaimer" class="header-anchor">#</a> Disclaimer</h2> <p>I know this isn't legally binding but if you're taking <strong>16-385</strong> now and you've
stumbled across this blog somehow and want to cheat know the following:</p> <ol><li>Please don't</li></ol> <p>I can't say much else.</p> <p>The code for Harris Corner Detectors is everywhere on the internet. These
concepts aren't super hard (if you're taking <strong>16-385</strong>). Because I'm not adding
too much more than other sources on the internet if someone is going to cheat
then they're going to cheat. I don't think I'm responsible for their decisions.</p> <p>The results and plots are mine to avoid plagiarising lecture slides (although
they are freely available online).</p> <h2 id="let-s-get-the-math-aside"><a href="#let-s-get-the-math-aside" class="header-anchor">#</a> Let's get the Math Aside</h2> <p>First we start with the mathematics. Buckle up because we're going to cover
quite a few subjects:</p> <h3 id="problem-specification"><a href="#problem-specification" class="header-anchor">#</a> Problem Specification</h3> <p>Okay before we jump into the math we need lets start with the problem statement.
Let's attempt to mathematically define a corner. What is a corner? Well if we're
at a corner then we know it has a horizontal edge and a vertical edge. Therefore
if we move a window around it we expect a strong response. Mathematically we can
say that this is the following</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>E</mi><mi>w</mi></msub><mo>(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo separator="true">;</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo><mo>=</mo><msub><mo>âˆ‘</mo><mrow><mi>s</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><mi>w</mi><mo>(</mo><mi>s</mi><mo separator="true">,</mo><mi>t</mi><mo>)</mo><mo>[</mo><mi>I</mi><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mi>s</mi><mo>+</mo><mi>u</mi><mo separator="true">,</mo><mi>y</mi><mo>âˆ’</mo><mi>t</mi><mo>+</mo><mi>v</mi><mo>)</mo><mo>âˆ’</mo><mi>I</mi><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mi>s</mi><mo separator="true">,</mo><mi>y</mi><mo>âˆ’</mo><mi>t</mi><mo>)</mo><msup><mo>]</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">E_w(u,v;x,y) = \sum_{s,t} w(s,t)[I(x-s+u,y-t+v) -I(x-s,y-t)]^2
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.0500050000000003em;"></span><span class="strut bottom" style="height:2.4361180000000004em;vertical-align:-1.386113em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.05764em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit">u</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mpunct">;</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mrel">=</span><span class="mop op-limits"><span class="vlist"><span style="top:1.150005em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit">t</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span><span class="op-symbol large-op mop">âˆ‘</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit">t</span><span class="mclose">)</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mbin">âˆ’</span><span class="mord mathit">s</span><span class="mbin">+</span><span class="mord mathit">u</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mbin">âˆ’</span><span class="mord mathit">t</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mclose">)</span><span class="mbin">âˆ’</span><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mbin">âˆ’</span><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mbin">âˆ’</span><span class="mord mathit">t</span><span class="mclose">)</span><span class="mclose"><span class="mclose">]</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span></span></p> <p>Let's break down what this equation is:</p> <ol><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>w</mi><mo>(</mo><mi>s</mi><mo separator="true">,</mo><mi>t</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">w(s,t)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit">t</span><span class="mclose">)</span></span></span></span> is our window function</li> <li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>I</mi><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mi>s</mi><mo separator="true">,</mo><mi>y</mi><mo>âˆ’</mo><mi>t</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">I(x-s,y-t)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mbin">âˆ’</span><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mbin">âˆ’</span><span class="mord mathit">t</span><span class="mclose">)</span></span></span></span> is our original intensity</li> <li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>[</mo><mi>a</mi><mo>âˆ’</mo><mi>b</mi><msup><mo>]</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">[a-b]^2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">[</span><span class="mord mathit">a</span><span class="mbin">âˆ’</span><span class="mord mathit">b</span><span class="mclose"><span class="mclose">]</span><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> is our sum of squared differences.</li> <li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>I</mi><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mi>s</mi><mo>+</mo><mi>u</mi><mo separator="true">,</mo><mi>y</mi><mo>âˆ’</mo><mi>t</mi><mo>+</mo><mi>v</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">I(x-s+u,y-t+v)</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mbin">âˆ’</span><span class="mord mathit">s</span><span class="mbin">+</span><span class="mord mathit">u</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mbin">âˆ’</span><span class="mord mathit">t</span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span> is our shifted intensity</li></ol> <p>TODO: add visually what I'm talking about</p> <p>Using a second order taylor expansion we can get the following (the proof will
be left as an excercise to the reader ðŸ˜ƒ )</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>E</mi><mi>w</mi></msub><mo>(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo separator="true">;</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo><mo>=</mo><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mi>u</mi></mrow></mtd><mtd><mrow><mi>v</mi></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><msub><mo>âˆ‘</mo><mrow><mi>s</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><msubsup><mi>I</mi><mi>x</mi><mn>2</mn></msubsup><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mi>s</mi><mo separator="true">,</mo><mi>y</mi><mo>âˆ’</mo><mi>t</mi><mo>)</mo></mrow></mtd><mtd><mrow><msub><mo>âˆ‘</mo><mrow><mi>s</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><msub><mi>I</mi><mrow><mi>x</mi><mi>y</mi></mrow></msub><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mi>s</mi><mo separator="true">,</mo><mi>y</mi><mo>âˆ’</mo><mi>t</mi><mo>)</mo></mrow></mtd></mtr><mtr><mtd><mrow><msub><mo>âˆ‘</mo><mrow><mi>s</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><msub><mi>I</mi><mrow><mi>x</mi><mi>y</mi></mrow></msub><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mi>s</mi><mo separator="true">,</mo><mi>y</mi><mo>âˆ’</mo><mi>t</mi><mo>)</mo></mrow></mtd><mtd><mrow><msub><mo>âˆ‘</mo><mrow><mi>s</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><msubsup><mi>I</mi><mi>y</mi><mn>2</mn></msubsup><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mi>s</mi><mo separator="true">,</mo><mi>y</mi><mo>âˆ’</mo><mi>t</mi><mo>)</mo></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mi>u</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>v</mi></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">E_w(u,v;x,y) = \begin{bmatrix}
        u &amp; v 
        \end{bmatrix}
        \begin{bmatrix}
        \sum_{s,t} I_x^2(x-s,y-t) &amp; \sum_{s,t} I_{xy}(x-s,y-t)\\
        \sum_{s,t} I_{xy}(x-s,y-t)&amp; \sum_{s,t} I_y^2(x-s,y-t)
        \end{bmatrix}
        \begin{bmatrix}
        u \\ v
        \end{bmatrix}
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:2.6861180000000004em;"></span><span class="strut bottom" style="height:4.872236000000001em;vertical-align:-2.1861180000000004em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.05764em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.02691em;">w</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit">u</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mpunct">;</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mrel">=</span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-0.010000000000000009em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">u</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-0.010000000000000009em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size1">]</span></span></span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:1.50501em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ£</span></span></span><span style="top:0.35001000000000015em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¢</span></span></span><span style="top:-0.2509899999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¢</span></span></span><span style="top:-1.49701em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¡</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-1.6361130000000002em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop op-limits"><span class="vlist"><span style="top:1.150005em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit">t</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span><span class="op-symbol large-op mop">âˆ‘</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.247em;margin-left:-0.07847em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">x</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mbin">âˆ’</span><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mbin">âˆ’</span><span class="mord mathit">t</span><span class="mclose">)</span></span></span><span style="top:0.8000050000000005em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop op-limits"><span class="vlist"><span style="top:1.150005em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit">t</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span><span class="op-symbol large-op mop">âˆ‘</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">x</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mbin">âˆ’</span><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mbin">âˆ’</span><span class="mord mathit">t</span><span class="mclose">)</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-1.6361130000000002em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop op-limits"><span class="vlist"><span style="top:1.150005em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit">t</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span><span class="op-symbol large-op mop">âˆ‘</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">x</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mbin">âˆ’</span><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mbin">âˆ’</span><span class="mord mathit">t</span><span class="mclose">)</span></span></span><span style="top:0.8000050000000005em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop op-limits"><span class="vlist"><span style="top:1.150005em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit">t</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span><span class="op-symbol large-op mop">âˆ‘</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.24700000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span style="top:-0.41300000000000003em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mbin">âˆ’</span><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mbin">âˆ’</span><span class="mord mathit">t</span><span class="mclose">)</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:1.50501em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¦</span></span></span><span style="top:0.35001000000000015em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¥</span></span></span><span style="top:-0.2509899999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¥</span></span></span><span style="top:-1.49701em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¤</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">u</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p> <p>Now since we're going to eventually be doing this on a computer we want to make
this as few operations as possible. Therefore I'll propose one further step
which is the following</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><msub><mo>âˆ‘</mo><mrow><mi>s</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><msubsup><mi>I</mi><mi>x</mi><mn>2</mn></msubsup><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mi>s</mi><mo separator="true">,</mo><mi>y</mi><mo>âˆ’</mo><mi>t</mi><mo>)</mo></mrow></mtd><mtd><mrow><msub><mo>âˆ‘</mo><mrow><mi>s</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><msub><mi>I</mi><mrow><mi>x</mi><mi>y</mi></mrow></msub><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mi>s</mi><mo separator="true">,</mo><mi>y</mi><mo>âˆ’</mo><mi>t</mi><mo>)</mo></mrow></mtd></mtr><mtr><mtd><mrow><msub><mo>âˆ‘</mo><mrow><mi>s</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><msub><mi>I</mi><mrow><mi>x</mi><mi>y</mi></mrow></msub><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mi>s</mi><mo separator="true">,</mo><mi>y</mi><mo>âˆ’</mo><mi>t</mi><mo>)</mo></mrow></mtd><mtd><mrow><msub><mo>âˆ‘</mo><mrow><mi>s</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><msubsup><mi>I</mi><mi>y</mi><mn>2</mn></msubsup><mo>(</mo><mi>x</mi><mo>âˆ’</mo><mi>s</mi><mo separator="true">,</mo><mi>y</mi><mo>âˆ’</mo><mi>t</mi><mo>)</mo></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><msub><mo>âˆ‘</mo><mrow><mi>s</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><mi>w</mi><mo>(</mo><mi>s</mi><mo separator="true">,</mo><mi>t</mi><mo>)</mo><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><msubsup><mi>I</mi><mi>x</mi><mn>2</mn></msubsup></mrow></mtd><mtd><mrow></mrow></mtd><mtd><mrow><msub><mi>I</mi><mi>x</mi></msub><mi>y</mi></mrow></mtd></mtr><mtr><mtd><mrow><msub><mi>I</mi><mi>x</mi></msub><mi>y</mi></mrow></mtd><mtd><mrow></mrow></mtd><mtd><mrow><msubsup><mi>I</mi><mi>y</mi><mn>2</mn></msubsup></mrow></mtd></mtr><mtr><mtd><mrow></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">        \begin{bmatrix}
        \sum_{s,t} I_x^2(x-s,y-t) &amp; \sum_{s,t} I_{xy}(x-s,y-t)\\
        \sum_{s,t} I_{xy}(x-s,y-t)&amp; \sum_{s,t} I_y^2(x-s,y-t)
        \end{bmatrix}
        = 
        \sum_{s,t} w(s,t) 
        \begin{bmatrix}
        I_x^2 &amp;&amp; I_xy \\
        I_xy &amp;&amp; I_y^2 \\
        \end{bmatrix}
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:2.6861180000000004em;"></span><span class="strut bottom" style="height:4.872236000000001em;vertical-align:-2.1861180000000004em;"></span><span class="base displaystyle textstyle uncramped"><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:1.50501em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ£</span></span></span><span style="top:0.35001000000000015em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¢</span></span></span><span style="top:-0.2509899999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¢</span></span></span><span style="top:-1.49701em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¡</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-1.6361130000000002em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop op-limits"><span class="vlist"><span style="top:1.150005em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit">t</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span><span class="op-symbol large-op mop">âˆ‘</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.247em;margin-left:-0.07847em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">x</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mbin">âˆ’</span><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mbin">âˆ’</span><span class="mord mathit">t</span><span class="mclose">)</span></span></span><span style="top:0.8000050000000005em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop op-limits"><span class="vlist"><span style="top:1.150005em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit">t</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span><span class="op-symbol large-op mop">âˆ‘</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">x</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mbin">âˆ’</span><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mbin">âˆ’</span><span class="mord mathit">t</span><span class="mclose">)</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-1.6361130000000002em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop op-limits"><span class="vlist"><span style="top:1.150005em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit">t</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span><span class="op-symbol large-op mop">âˆ‘</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">x</span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mbin">âˆ’</span><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mbin">âˆ’</span><span class="mord mathit">t</span><span class="mclose">)</span></span></span><span style="top:0.8000050000000005em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mop op-limits"><span class="vlist"><span style="top:1.150005em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit">t</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span><span class="op-symbol large-op mop">âˆ‘</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.24700000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span style="top:-0.41300000000000003em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mbin">âˆ’</span><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mbin">âˆ’</span><span class="mord mathit">t</span><span class="mclose">)</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:1.50501em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¦</span></span></span><span style="top:0.35001000000000015em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¥</span></span></span><span style="top:-0.2509899999999998em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¥</span></span></span><span style="top:-1.49701em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¤</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span><span class="mrel">=</span><span class="mop op-limits"><span class="vlist"><span style="top:1.150005em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord scriptstyle cramped"><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit">t</span></span></span></span><span style="top:-0.000005000000000143778em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span><span class="op-symbol large-op mop">âˆ‘</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="mopen">(</span><span class="mord mathit">s</span><span class="mpunct">,</span><span class="mord mathit">t</span><span class="mclose">)</span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.9049999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ£</span></span></span><span style="top:-0.89502em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¡</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-1.2215540000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.247em;margin-left:-0.07847em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">x</span></span></span><span style="top:-0.4129999999999999em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span><span style="top:0.002553999999999945em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">x</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span style="top:1.225662em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-1.2215540000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span style="top:0.002553999999999945em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-1.2215540000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit">x</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span style="top:0.002553999999999945em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.24700000000000003em;margin-left:-0.07847em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span style="top:-0.41300000000000003em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.9049999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¦</span></span></span><span style="top:-0.89502em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="delimsizinginner delim-size4"><span>âŽ¤</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span></span></span></span></p> <p>Notice this matrix is diagonal. This will be important later.</p> <h3 id="fun-with-matrices"><a href="#fun-with-matrices" class="header-anchor">#</a> Fun with Matrices</h3> <p><strong>Note:</strong> \LaTeX <strong>rendering is temperamental</strong></p> <p>First we start with polynomials and their matrix representation.</p> <p>Consider the following:</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo><mo>=</mo><mrow><msup><mi>x</mi><mn>2</mn></msup></mrow><mo>+</mo><mrow><msup><mi>y</mi><mn>2</mn></msup></mrow></mrow><annotation encoding="application/x-tex">f(x,y) = {x^2} + {y^2}
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.8641079999999999em;"></span><span class="strut bottom" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit">x</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span><span class="mbin">+</span><span class="mord displaystyle textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span></span></span></p> <p><img src="/assets/img/x2y2.a71a8c51.png" alt="Figure [Equation Plot]: "></p> <p>We can rewrite the above equation in matrix form as follows</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo><mo>=</mo><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mi>x</mi></mrow></mtd><mtd><mrow><mi>y</mi></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow><msub><mi>I</mi><mn>2</mn></msub><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mi>x</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>y</mi></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex"> f(x,y) = \begin{bmatrix} x &amp; y \end{bmatrix}  I_2 \begin{bmatrix}
x \\ y \end{bmatrix}</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.45em;"></span><span class="strut bottom" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mrel">=</span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-0.010000000000000009em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">x</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-0.010000000000000009em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size1">]</span></span></span><span class="mord"><span class="mord mathit" style="margin-right:0.07847em;">I</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.07847em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit">x</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p> <p>Why would we want to do that? Well, the reason is if we take the &quot;coefficient
matrix&quot; and get it's Singular Value Decomposition we see that the coefficient
matrix describes an ellipse.</p> <p>Recall the Singular Value Decomposition of a matrix is the following:</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mo>=</mo><mi>U</mi><mo>âˆ‘</mo><msup><mi>V</mi><mo>âˆ—</mo></msup></mrow><annotation encoding="application/x-tex">M = U \sum V^*
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.05em;"></span><span class="strut bottom" style="height:1.6000100000000002em;vertical-align:-0.55001em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.10903em;">U</span><span class="op-symbol large-op mop" style="top:-0.000004999999999977245em;">âˆ‘</span><span class="mord"><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord">âˆ—</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span></span></p> <p>So in our case of an identity matrix it'd be</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mn>1</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>1</mn></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mn>1</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>1</mn></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mn>1</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>1</mn></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow><msup><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mrow><mn>1</mn></mrow></mtd><mtd><mrow><mn>0</mn></mrow></mtd></mtr><mtr><mtd><mrow><mn>0</mn></mrow></mtd><mtd><mrow><mn>1</mn></mrow></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mi>T</mi></msup></mrow><annotation encoding="application/x-tex"> \begin{bmatrix} 1 &amp; 0 \\ 0 &amp; 1\end{bmatrix} =
 \begin{bmatrix} 1 &amp; 0 \\ 0 &amp; 1\end{bmatrix} 
 \begin{bmatrix} 1 &amp; 0 \\ 0 &amp; 1\end{bmatrix} 
 \begin{bmatrix} 1 &amp; 0 \\ 0 &amp; 1\end{bmatrix}^T 
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:1.542331em;"></span><span class="strut bottom" style="height:2.492361em;vertical-align:-0.95003em;"></span><span class="base displaystyle textstyle uncramped"><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">1</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="mrel">=</span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">1</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">1</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="minner"><span class="minner displaystyle textstyle uncramped"><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">1</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist"><span style="top:-0.6099999999999999em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">0</span></span></span><span style="top:0.5900000000000003em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span><span class="style-wrap reset-textstyle textstyle uncramped" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="vlist"><span style="top:-1.064em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span></span></p> <p>Where we can think of the columns of our first matrix as the eigenvectors and
the diagonal of our second matrix as our eigenvalues. I say &quot;we can think&quot;
because generally these are psuedo eigenvectors and eigenvalues. The <strong>SVD</strong>
allows us to compute eigenvalues and vectors for matrices that otherwise might
not have them. This is super helpful is computer vision. Without going into too
much detail the solution to the equation <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi><mi>x</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Ax=0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">A</span><span class="mord mathit">x</span><span class="mrel">=</span><span class="mord mathrm">0</span></span></span></span> is the eigenvector corresponding
to the small eigenvalue of the <strong>SVD</strong> of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">A</span></span></span></span>.</p> <h3 id="last-steps"><a href="#last-steps" class="header-anchor">#</a> Last Steps</h3> <p>We've now shown that our eigenvalues and vectors are equivalent to describing an
ellipse in 3d space. Because we want a corner we want as strong a 3d response as
possible.</p> <p>We can think of our eigenvector test as follows:</p> <ol><li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î»</mi><mn>1</mn></msub><mo>&gt;</mo><mo>&gt;</mo><msub><mi>Î»</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\lambda_1 &gt;&gt; \lambda_2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">Î»</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mrel">&gt;</span><span class="mrel">&gt;</span><span class="mord"><span class="mord mathit">Î»</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> vertical edge</li> <li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î»</mi><mn>2</mn></msub><mo>&gt;</mo><mo>&gt;</mo><msub><mi>Î»</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\lambda_2 &gt;&gt; \lambda_1</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">Î»</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mrel">&gt;</span><span class="mrel">&gt;</span><span class="mord"><span class="mord mathit">Î»</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> horizontal edge</li> <li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î»</mi><mn>1</mn></msub><mo>âˆ¼</mo><msub><mi>Î»</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">\lambda_1 \sim \lambda_2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">Î»</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mrel">âˆ¼</span><span class="mord"><span class="mord mathit">Î»</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> corner</li> <li><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>Î»</mi><mn>1</mn></msub><mo>âˆ¼</mo><msub><mi>Î»</mi><mn>2</mn></msub><mo>âˆ¼</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\lambda_1 \sim \lambda_2 \sim 0</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit">Î»</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mrel">âˆ¼</span><span class="mord"><span class="mord mathit">Î»</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mrel">âˆ¼</span><span class="mord mathrm">0</span></span></span></span> flat region</li></ol> <p>There's a lot of &quot;cornerness&quot; tests but the one I'll be using is the following</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mo>=</mo><msub><mi>Î»</mi><mn>1</mn></msub><msub><mi>Î»</mi><mn>2</mn></msub><mo>âˆ’</mo><mi>K</mi><mo>(</mo><msub><mi>Î»</mi><mn>1</mn></msub><mo>+</mo><msub><mi>Î»</mi><mn>2</mn></msub><msup><mo>)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">R= \lambda_1 \lambda_2 - K(\lambda_1 + \lambda_2)^2
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.8641079999999999em;"></span><span class="strut bottom" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mrel">=</span><span class="mord"><span class="mord mathit">Î»</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mord"><span class="mord mathit">Î»</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mbin">âˆ’</span><span class="mord mathit" style="margin-right:0.07153em;">K</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">Î»</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mbin">+</span><span class="mord"><span class="mord mathit">Î»</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mclose"><span class="mclose">)</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span></span></p> <p>Where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>âˆˆ</mo><mo>[</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>0</mn><mn>4</mn><mo separator="true">,</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>0</mn><mn>6</mn><mo>]</mo></mrow><annotation encoding="application/x-tex">k\in [0.04,0.06]</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mrel">âˆˆ</span><span class="mopen">[</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">0</span><span class="mord mathrm">4</span><span class="mpunct">,</span><span class="mord mathrm">0</span><span class="mord mathrm">.</span><span class="mord mathrm">0</span><span class="mord mathrm">6</span><span class="mclose">]</span></span></span></span> and is a normalizing constant. See here for more.</p> <p>Why is this test so powerful? Well recall that our matrix (also known as the
structural tensor in literature) is diagonal. This means its eigen values follow
along its diagonal.</p> <p>Therefore the above test is equivalent to</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi><mo>=</mo><mi>d</mi><mi>e</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>n</mi><mi>t</mi><mo>(</mo><mi>M</mi><mo>)</mo><mo>âˆ’</mo><mi>k</mi><mo>â‹…</mo><mi>t</mi><mi>r</mi><mi>a</mi><mi>c</mi><mi>e</mi><mo>(</mo><mi>M</mi><msup><mo>)</mo><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">R= determinant(M) - k\cdot trace(M)^2
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.8641079999999999em;"></span><span class="strut bottom" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.00773em;">R</span><span class="mrel">=</span><span class="mord mathit">d</span><span class="mord mathit">e</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">m</span><span class="mord mathit">i</span><span class="mord mathit">n</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mclose">)</span><span class="mbin">âˆ’</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mbin">â‹…</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit">c</span><span class="mord mathit">e</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mclose"><span class="mclose">)</span><span class="vlist"><span style="top:-0.413em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle uncramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span></span></p> <p>Which we can really easily compute.</p> <h2 id="code"><a href="#code" class="header-anchor">#</a> Code</h2> <h3 id="code-with-minimal-libraries"><a href="#code-with-minimal-libraries" class="header-anchor">#</a> Code with minimal libraries</h3> <p>Here is code with minimal libraries. This code is fairly naive and as a result
slow. One improvement is that we can harness the distributive property of
convolutions. If you notice, we apply a gaussian kernel twice in the sobel
filters. The reason I kept this in is because I wanted each function to stand on
its own ie if you were calling <code>sobel_X</code> it should return the proper <code>sobel</code>
results.</p> <p>If we wanted to make improvements we'd know that we eventually apply a smoothing kernel
at the very end and so we'd put off our gaussian blurring until then. This would
result in a few fewer convolutions and therefore a big time speedup.</p> <p>Convolutions are by far the most expensive operation.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv
<span class="token keyword">from</span> math <span class="token keyword">import</span> ceil
<span class="token keyword">from</span> scipy <span class="token keyword">import</span> signal

<span class="token keyword">def</span> <span class="token function">myImageFilter</span><span class="token punctuation">(</span>img0<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    This function takes an image and a kernel and returns the convolution of
    them.  Note: the math in the for loop is actually perform correlation on a
    flipped kernel.
    &quot;&quot;&quot;</span>
    <span class="token punctuation">(</span>length<span class="token punctuation">,</span> width<span class="token punctuation">)</span> <span class="token operator">=</span> h<span class="token punctuation">.</span>shape

    <span class="token comment"># check that the kernel is square and odd</span>
    <span class="token keyword">assert</span><span class="token punctuation">(</span>length <span class="token operator">==</span> width <span class="token keyword">and</span> <span class="token punctuation">(</span>length <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># pad image to edges</span>
    padded_im <span class="token operator">=</span> np<span class="token punctuation">.</span>pad<span class="token punctuation">(</span>img0<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>width<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span> width<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
        <span class="token punctuation">(</span>length<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">,</span>length<span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;edge&quot;</span><span class="token punctuation">)</span> 

    <span class="token comment"># We only want to work on the padded pixels not the unpadded ones</span>
    <span class="token punctuation">(</span>orig_len<span class="token punctuation">,</span> orig_width<span class="token punctuation">)</span> <span class="token operator">=</span> img0<span class="token punctuation">.</span>shape
    new_img <span class="token operator">=</span> np<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">[</span>orig_len<span class="token punctuation">,</span> orig_width<span class="token punctuation">]</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>img0<span class="token punctuation">.</span>dtype<span class="token punctuation">)</span>

    <span class="token comment"># we want to flip the kernel to get convolution</span>
    h <span class="token operator">=</span> np<span class="token punctuation">.</span>flip<span class="token punctuation">(</span>h<span class="token punctuation">)</span> 

    <span class="token keyword">for</span> i <span class="token keyword">in</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>orig_len<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>orig_width<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># this gets the slice of the </span>
            <span class="token comment"># padded array that is the size of the kernel </span>
            <span class="token comment"># whose center correspond to i,j in the image</span>
            comp <span class="token operator">=</span> padded_im<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span>length<span class="token punctuation">,</span>j<span class="token punctuation">:</span>j<span class="token operator">+</span>width<span class="token punctuation">]</span> 
            new_img<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>h <span class="token operator">*</span> comp<span class="token punctuation">)</span>

    <span class="token keyword">return</span> new_img

<span class="token keyword">def</span> <span class="token function">myGaussianKernel</span><span class="token punctuation">(</span>sigma<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Returns a 2D gaussian kernel
    &quot;&quot;&quot;</span>
    hsize <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> ceil<span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> sigma<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    gaussianWindow <span class="token operator">=</span> signal<span class="token punctuation">.</span>windows<span class="token punctuation">.</span>gaussian<span class="token punctuation">(</span>hsize<span class="token punctuation">,</span> sigma<span class="token punctuation">)</span>

    tmp_gaussian <span class="token operator">=</span> gaussianWindow<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># makes a copy</span>
    tmp_gaussian<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token punctuation">[</span>hsize<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#resizes</span>

    <span class="token comment"># forms 2d matrix and normalizes values</span>
    gaussianKernel <span class="token operator">=</span> tmp_gaussian <span class="token operator">*</span> gaussianWindow

    <span class="token comment"># to form the vector norm then take 1/sum if there are negative numbers</span>
    <span class="token comment"># then take one over the sum of positive numbers</span>
    gaussianKernel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>gaussianKernel<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> gaussianKernel
    <span class="token keyword">return</span> gaussianKernel

<span class="token keyword">def</span> <span class="token function">mySobelY</span><span class="token punctuation">(</span>img0<span class="token punctuation">,</span> sigma<span class="token operator">=</span><span class="token number">2.4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Calculates the y derivative of an image
    &quot;&quot;&quot;</span>
    gaussian <span class="token operator">=</span> myGaussianKernel<span class="token punctuation">(</span>sigma<span class="token punctuation">)</span>
    sobel_y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    blurredImage <span class="token operator">=</span> myImageFilter<span class="token punctuation">(</span>img0<span class="token punctuation">,</span> gaussian<span class="token punctuation">)</span>
    <span class="token keyword">return</span> myImageFilter<span class="token punctuation">(</span>blurredImage<span class="token punctuation">,</span> sobel_y<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">mySobelX</span><span class="token punctuation">(</span>img0<span class="token punctuation">,</span> sigma<span class="token operator">=</span><span class="token number">2.4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Calculates the x derivative of an image
    &quot;&quot;&quot;</span>
    gaussian <span class="token operator">=</span> myGaussianKernel<span class="token punctuation">(</span>sigma<span class="token punctuation">)</span>
    sobel_x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    blurredImage <span class="token operator">=</span> myImageFilter<span class="token punctuation">(</span>img0<span class="token punctuation">,</span> gaussian<span class="token punctuation">)</span>
    <span class="token keyword">return</span> myImageFilter<span class="token punctuation">(</span>blurredImage<span class="token punctuation">,</span> sobel_x<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">getkMaxVals</span><span class="token punctuation">(</span>mat<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    Gets the k max values in a tensor
    &quot;&quot;&quot;</span>
    <span class="token comment"># Partially sort the max values and get the k max indices</span>
    indx <span class="token operator">=</span> np<span class="token punctuation">.</span>argpartition<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> mat<span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span>k<span class="token punctuation">]</span>
    <span class="token comment"># Reconstruct the original indices</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>column_stack<span class="token punctuation">(</span>np<span class="token punctuation">.</span>unravel_index<span class="token punctuation">(</span>indx<span class="token punctuation">,</span> mat<span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">myHarris</span><span class="token punctuation">(</span>I<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">0.04</span><span class="token punctuation">,</span> P<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    My Harris Corner Detector
    &quot;&quot;&quot;</span>
    <span class="token comment"># If the image is in color conver it to grayscale</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>I<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span> <span class="token keyword">and</span> I<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
        I <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>I<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>
    <span class="token comment"># Scale to floats assuming input is of type int8</span>
    <span class="token keyword">if</span> I<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1.0</span><span class="token punctuation">:</span>
        I <span class="token operator">=</span> I <span class="token operator">/</span> <span class="token number">255.0</span>

    <span class="token comment"># Calculate derivatives</span>
    dx <span class="token operator">=</span> mySobelX<span class="token punctuation">(</span>I<span class="token punctuation">)</span>
    dy <span class="token operator">=</span> mySobelY<span class="token punctuation">(</span>I<span class="token punctuation">)</span>

    <span class="token comment"># Convolution kernel (aka blurring)</span>
    kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>P<span class="token punctuation">,</span>P<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Note these aren't real eigen values</span>
    eigen1 <span class="token operator">=</span> <span class="token punctuation">(</span>dx<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>
    eigen2 <span class="token operator">=</span> <span class="token punctuation">(</span>dy<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>

    <span class="token comment"># Calculate R score</span>
    R <span class="token operator">=</span> <span class="token punctuation">(</span>eigen1<span class="token operator">*</span> eigen2<span class="token punctuation">)</span> <span class="token operator">-</span> k <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>eigen1 <span class="token operator">+</span> eigen2<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>

    <span class="token comment"># Apply convolution</span>
    points <span class="token operator">=</span> myImageFilter<span class="token punctuation">(</span>R<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span>

    <span class="token comment"># Return max values</span>
    <span class="token keyword">return</span> getkMaxVals<span class="token punctuation">(</span>points<span class="token punctuation">,</span> alpha<span class="token punctuation">)</span><span class="token punctuation">,</span> points
    
     
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token comment"># Import data</span>
    <span class="token keyword">from</span> skimage <span class="token keyword">import</span> data
    <span class="token comment"># Import plotting library</span>
    <span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

    <span class="token comment"># Load an image</span>
    I <span class="token operator">=</span> data<span class="token punctuation">.</span>astronaut<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Note p is not sorted</span>
    p<span class="token punctuation">,</span> R <span class="token operator">=</span> myHarris<span class="token punctuation">(</span>I<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
    fig<span class="token punctuation">,</span> axis <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    axis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>I<span class="token punctuation">)</span>
    <span class="token comment"># Remember x and y values are flipped</span>
    <span class="token comment"># p rows are y values</span>
    <span class="token comment"># p columns are x values</span>
    axis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>p<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    axis<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>R<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="/assets/img/myHarris.bc0d7201.png" alt="Figure [Harris Output]: "></p> <p>The bottom plot is a plot of the <code>R</code> test.</p> <p>I would say the results are not bad. As you can see there's a lot of clustering
on the helmet and if you look at the <code>R</code> test plot that's where our strongest
results are. The reason this happens is we naively take the highest responses.
One solution to this problem would be to work on a lower resolution image. A
lower resolution means that we would've have fewer responses.</p> <p>The best solution is to use a technique called Non-maximal Supression. The idea
is simple. First we dilate. Dilation is defined as</p> <p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi><mi>i</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo>)</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo>(</mo><mi>x</mi><mo>+</mo><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><mi>y</mi><mo>+</mo><msub><mi>w</mi><mn>2</mn></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">Dilate(x,y) = max(x + w_1, y +w_2)
</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord mathit" style="margin-right:0.02778em;">D</span><span class="mord mathit">i</span><span class="mord mathit" style="margin-right:0.01968em;">l</span><span class="mord mathit">a</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mrel">=</span><span class="mord mathit">m</span><span class="mord mathit">a</span><span class="mord mathit">x</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mbin">+</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mpunct">,</span><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="mbin">+</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mclose">)</span></span></span></span></span></p> <p>Where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>w</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">w_1,w_2</annotation></semantics></math></span><span aria-hidden="true" class="katex-html"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.02691em;">w</span><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.02691em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span><span class="reset-textstyle scriptstyle cramped"><span class="mord mathrm">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">â€‹</span></span>â€‹</span></span></span></span></span></span> are window sizes. The idea is that we set each pixel to the
maximum value in a window around it. You can read more about dilation
<a href="https://docs.opencv.org/3.4/db/df6/tutorial_erosion_dilatation.html" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>After dilating each pixel is set to its max neighbor. We then return</p> <p><code>dilated(img) == orig_img</code></p> <p>The idea is that if a value was the maximum in its neighborhood in the original
image then it'll stay the same so the above equality would return true for that
pixel. If it wasn't, ie it got set to the maximum by the dilation operation then
that inequality will be false so it'll be set to 0.</p> <p>This  technique is commonly used to make thick lines pixel-width.</p> <h3 id="code-with-some-libraries-and-improvements"><a href="#code-with-some-libraries-and-improvements" class="header-anchor">#</a> Code with some libraries and improvements</h3> <p>Here we use <code>corner_peaks</code> to perform Non-maximal Suppression.
We also use <code>opencv</code> to perform the sobel calculations.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv
<span class="token keyword">from</span> scipy <span class="token keyword">import</span> ndimage
<span class="token keyword">from</span> utils <span class="token keyword">import</span> imfilter
<span class="token keyword">from</span> skimage<span class="token punctuation">.</span>feature <span class="token keyword">import</span> corner_peaks

<span class="token keyword">def</span> <span class="token function">NMSmyHarris</span><span class="token punctuation">(</span>I<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> k<span class="token punctuation">,</span> P<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># P defines the kernel size</span>

    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>I<span class="token punctuation">.</span>shape<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span> <span class="token keyword">and</span> I<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
        I <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>I<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_RGB2GRAY<span class="token punctuation">)</span>
    <span class="token keyword">if</span> I<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1.0</span><span class="token punctuation">:</span>
        I <span class="token operator">=</span> I <span class="token operator">/</span> <span class="token number">255.0</span>

    <span class="token comment"># outputimage will have the same depth and type as source</span>
    ddepth <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>

    dx <span class="token operator">=</span> cv<span class="token punctuation">.</span>Sobel<span class="token punctuation">(</span>I<span class="token punctuation">,</span> ddepth<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> ksize<span class="token operator">=</span>P<span class="token punctuation">,</span> borderType<span class="token operator">=</span>cv<span class="token punctuation">.</span>BORDER_DEFAULT<span class="token punctuation">)</span>
    dy <span class="token operator">=</span> cv<span class="token punctuation">.</span>Sobel<span class="token punctuation">(</span>I<span class="token punctuation">,</span> ddepth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> ksize<span class="token operator">=</span>P<span class="token punctuation">,</span> borderType<span class="token operator">=</span>cv<span class="token punctuation">.</span>BORDER_DEFAULT<span class="token punctuation">)</span>

    kernel <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span>P<span class="token punctuation">,</span>P<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Note these aren't actually eigen vectors</span>
    eigen1 <span class="token operator">=</span> <span class="token punctuation">(</span>dx<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>
    eigen2 <span class="token operator">=</span> <span class="token punctuation">(</span>dy<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>

    <span class="token comment"># Calculate R value</span>
    R <span class="token operator">=</span> <span class="token punctuation">(</span>eigen1 <span class="token operator">*</span> eigen2<span class="token punctuation">)</span> <span class="token operator">-</span> k <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>eigen1 <span class="token operator">+</span> eigen2<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>

    <span class="token comment"># Convolution of window on covariance matrix</span>
    points <span class="token operator">=</span> ndimage<span class="token punctuation">.</span>convolve<span class="token punctuation">(</span>R<span class="token punctuation">,</span> kernel<span class="token punctuation">)</span>
    
    <span class="token comment"># NMS and max indices in one go!</span>
    <span class="token comment"># returns data in (x,y) form and in alpha x 2 shape</span>
    <span class="token keyword">return</span> corner_peaks<span class="token punctuation">(</span>points<span class="token punctuation">,</span> min_distance<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> threshold_rel<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> 
        num_peaks<span class="token operator">=</span>alpha<span class="token punctuation">)</span>
</code></pre></div><h3 id="oneliner"><a href="#oneliner" class="header-anchor">#</a> Oneliner</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> skimage<span class="token punctuation">.</span>feature <span class="token keyword">import</span> corner_harris<span class="token punctuation">,</span> corner_peaks

<span class="token keyword">def</span> <span class="token function">HarrisOneLine</span><span class="token punctuation">(</span>I<span class="token punctuation">,</span> alpha<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> corner_peaks<span class="token punctuation">(</span>corner_harris<span class="token punctuation">(</span>I<span class="token punctuation">,</span>k<span class="token operator">=</span><span class="token number">.04</span><span class="token punctuation">)</span><span class="token punctuation">,</span> min_distance<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> \
            num_peaks<span class="token operator">=</span>alpha<span class="token punctuation">,</span> threshold_rel<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="benchmarks"><a href="#benchmarks" class="header-anchor">#</a> Benchmarks</h3> <p>The following is the benchmark code. There are slight modifications to
<code>myHarris</code> and <code>NMSmyHarris</code> where I removed the conversion to grayscale.
This was to ensure that all functions were tested on their Harris calculating
ability.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv
<span class="token keyword">from</span> math <span class="token keyword">import</span> ceil
<span class="token keyword">from</span> scipy <span class="token keyword">import</span> signal
<span class="token keyword">from</span> skimage<span class="token punctuation">.</span>feature <span class="token keyword">import</span> corner_harris
<span class="token keyword">from</span> skimage<span class="token punctuation">.</span>feature <span class="token keyword">import</span> corner_peaks
<span class="token keyword">from</span> skimage<span class="token punctuation">.</span>feature <span class="token keyword">import</span> corner_fast
<span class="token keyword">from</span> scipy <span class="token keyword">import</span> ndimage
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">timeit</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">timed</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kw<span class="token punctuation">)</span><span class="token punctuation">:</span>
        ts <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        result <span class="token operator">=</span> method<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span>
        te <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        
        <span class="token keyword">if</span> <span class="token string">'log_time'</span> <span class="token keyword">in</span> kw<span class="token punctuation">:</span>
            name <span class="token operator">=</span> kw<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'log_name'</span><span class="token punctuation">,</span> method<span class="token punctuation">.</span>__name__<span class="token punctuation">)</span>
            kw<span class="token punctuation">[</span><span class="token string">'log_time'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>te <span class="token operator">-</span> ts<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'name{}  {:.4e} ms'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span>__name__<span class="token punctuation">,</span> <span class="token punctuation">(</span>te <span class="token operator">-</span> ts<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> result    
    <span class="token keyword">return</span> timed

<span class="token decorator annotation punctuation">@timeit</span>
<span class="token keyword">def</span> <span class="token function">myHarris</span><span class="token punctuation">(</span>I<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">0.04</span><span class="token punctuation">,</span> P<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token decorator annotation punctuation">@timeit</span>
<span class="token keyword">def</span> <span class="token function">NMSmyHarris</span><span class="token punctuation">(</span>I<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> k<span class="token operator">=</span><span class="token number">0.04</span><span class="token punctuation">,</span> P<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token decorator annotation punctuation">@timeit</span>
<span class="token keyword">def</span> <span class="token function">HarrisOneline</span><span class="token punctuation">(</span>I<span class="token punctuation">,</span> alpha<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token decorator annotation punctuation">@timeit</span>
<span class="token keyword">def</span> <span class="token function">fastHarris</span><span class="token punctuation">(</span>I<span class="token punctuation">,</span> alpha<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> corner_peaks<span class="token punctuation">(</span>corner_fast<span class="token punctuation">(</span>I<span class="token punctuation">)</span><span class="token punctuation">,</span> min_distance<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> \
            num_peaks<span class="token operator">=</span>alpha<span class="token punctuation">,</span> threshold_rel<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    
<span class="token keyword">def</span> <span class="token function">plotHarris</span><span class="token punctuation">(</span>axs<span class="token punctuation">,</span> I<span class="token punctuation">,</span> p<span class="token punctuation">,</span> title<span class="token punctuation">)</span><span class="token punctuation">:</span>
    axs<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>I<span class="token punctuation">)</span>
    <span class="token comment"># Remember x and y values are flipped</span>
    <span class="token comment"># p rows are y values</span>
    <span class="token comment"># p columns are x values</span>
    axs<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    axs<span class="token punctuation">.</span>title<span class="token punctuation">.</span>set_text<span class="token punctuation">(</span>title<span class="token punctuation">)</span>
     
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token comment"># Import data</span>
    <span class="token keyword">from</span> skimage <span class="token keyword">import</span> data
    <span class="token comment"># Import plotting library</span>
    <span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt

    <span class="token comment"># Load an image</span>
    I <span class="token operator">=</span> data<span class="token punctuation">.</span>astronaut<span class="token punctuation">(</span><span class="token punctuation">)</span>

    logtime_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    alpha <span class="token operator">=</span> <span class="token number">500</span>

    <span class="token comment"># Note p is not sorted</span>
    <span class="token comment"># Convert image to gray because</span>
    grayImage <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>I<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_RGB2GRAY<span class="token punctuation">)</span>
    p1<span class="token punctuation">,</span> R <span class="token operator">=</span> myHarris<span class="token punctuation">(</span>grayImage<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> log_time<span class="token operator">=</span>logtime_data<span class="token punctuation">)</span>
    p2 <span class="token operator">=</span> NMSmyHarris<span class="token punctuation">(</span>grayImage<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> log_time<span class="token operator">=</span>logtime_data<span class="token punctuation">)</span>
    p3 <span class="token operator">=</span> HarrisOneline<span class="token punctuation">(</span>grayImage<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> log_time<span class="token operator">=</span>logtime_data<span class="token punctuation">)</span>
    p4 <span class="token operator">=</span> fastHarris<span class="token punctuation">(</span>grayImage<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> log_time<span class="token operator">=</span>logtime_data<span class="token punctuation">)</span>
    fig<span class="token punctuation">,</span> axis <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>

    title <span class="token operator">=</span> <span class="token string">&quot;Benchmarks Harris Corner Detectors w/ alpha={}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>alpha<span class="token punctuation">)</span>
    fig<span class="token punctuation">.</span>suptitle<span class="token punctuation">(</span>title<span class="token punctuation">)</span>
    plotHarris<span class="token punctuation">(</span>axis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> I<span class="token punctuation">,</span> p1<span class="token punctuation">,</span> <span class="token string">&quot;Output of &quot;</span> \
            <span class="token string">&quot;myHarris t={:.5e}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>logtime_data<span class="token punctuation">[</span><span class="token string">&quot;myHarris&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plotHarris<span class="token punctuation">(</span>axis<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> I<span class="token punctuation">,</span> p1<span class="token punctuation">,</span> <span class="token string">&quot;Output of &quot;</span> \
            <span class="token string">&quot;NMSmyHarris t={:.5e}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>logtime_data<span class="token punctuation">[</span><span class="token string">&quot;NMSmyHarris&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plotHarris<span class="token punctuation">(</span>axis<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> I<span class="token punctuation">,</span> p1<span class="token punctuation">,</span> <span class="token string">&quot;Output of &quot;</span> \
            <span class="token string">&quot;HarrisOneline t={:.5e}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>logtime_data<span class="token punctuation">[</span><span class="token string">&quot;HarrisOneline&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    plotHarris<span class="token punctuation">(</span>axis<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> I<span class="token punctuation">,</span> p1<span class="token punctuation">,</span> <span class="token string">&quot;Output of &quot;</span> \
            <span class="token string">&quot;fastHarris t={:.5e}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>logtime_data<span class="token punctuation">[</span><span class="token string">&quot;fastHarris&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>And here are the outputs.</p> <p><img src="/assets/img/cachedHarris.89e621b0.png" alt="Figure [Harris Output w/ Caching]: "> <img src="/assets/img/cached100.962189b2.png" alt="Figure [Harris Output w/ Caching alpha=100]: "> <img src="/assets/img/uncached500.fbefadeb.png" alt="Figure [Harris Output w/ No Caching alpha=500]: "></p> <p>The cached timing benchmarks are somewhat meaningless but they do give you a
good idea of how much of the code is cacheable.</p> <p>The most important result is the last one where I removed <code>__pycache__</code> As you
can see, my results are slightly faster than the Harris oneliner. They're not
quite as fast however as the <code>corner_fast</code> I think this detector relies on
<code>FAST</code> image descriptors but I'm not entirely certain without looking at the
source code.</p> <p>As a last last note - my timing decorator is not perfect and these tests are not
scientific. They should be run multiple times but I'm lazy. The rough idea is
there.</p> <p>TL;DR My naive code â†’  slow, my non-naive code â†’  fast</p> <h2 id="after-thoughts"><a href="#after-thoughts" class="header-anchor">#</a> After thoughts</h2> <p>So what did we learn? Caching is good. But results are bad? Like all things in
Computer Vision the results can kinda be hit or miss and require a lot of
adjusting of parameters. If you want to improve the results I'd adjust inputs to
<code>corner_peaks</code> so that the output has less clustering. This image is also a
tough one because it's large and doesn't have super hard corners.</p> <p>I will say though, with very similar code as above I've gotten incredible
results before.</p> <p>Happy experimenting!</p></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#disclaimer" title="Disclaimer">Disclaimer</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#let-s-get-the-math-aside" title="Let's get the Math Aside">Let's get the Math Aside</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#problem-specification" title="Problem Specification">Problem Specification</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#fun-with-matrices" title="Fun with Matrices">Fun with Matrices</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#last-steps" title="Last Steps">Last Steps</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#code" title="Code">Code</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#code-with-minimal-libraries" title="Code with minimal libraries">Code with minimal libraries</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#code-with-some-libraries-and-improvements" title="Code with some libraries and improvements">Code with some libraries and improvements</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#oneliner" title="Oneliner">Oneliner</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#benchmarks" title="Benchmarks">Benchmarks</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#after-thoughts" title="After thoughts">After thoughts</a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8><li class="contact-item" data-v-3d9deeb8><a href="https://github.com/MilesConn/" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github" data-v-3d9deeb8><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" data-v-3d9deeb8></path></svg>
          
        </a></li></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8><li class="copyright-item" data-v-3d9deeb8><a href="https://policies.google.com/privacy?hl=en-US" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8>Privacy Policy</a></li><li class="copyright-item" data-v-3d9deeb8><a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" rel="noopener noreferrer" class="nav-link external" data-v-3d9deeb8>CC4.0 | Copyright Â© 2020-present</a></li></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6755fb66.js" defer></script><script src="/assets/js/7.f907bda9.js" defer></script><script src="/assets/js/3.eef58f39.js" defer></script><script src="/assets/js/6.f4eca287.js" defer></script>
  </body>
</html>
